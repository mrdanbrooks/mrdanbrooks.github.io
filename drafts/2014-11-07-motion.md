---
layout: post
title: Motion Security Camera
tags: linux
category: security
year: 2014
month: 11
day: 07
published: true
summary: Getting motion setup as a security camera involves more then just installing it.
---

Getting motion installed and working is ubuntu is pretty easy

```
sudo apt-get install motion
```

It works pretty well out of the box if you want to use it with a webcam, just try the following

```
sudo motion
```

and then look in your webbrowser at `127.0.0.1:8081`. Note that by default you have to do it from the server.


the tricky part is getting everything to work just right. In particular...
 
 * Select the video device you want to use 
 * Select a new location for storing data (perferably on a different media)
 * Use the normal port 80
 * Enable the motion tracking feature (this saves on images space when nothing is happening)
 * Allow other machines to see the server
 
We make the following adjustments to `/etc/motion/motion.conf`

```
daemon off
videodevice /dev/video1
target_dir /media/VIDEO
webcam_port 80
webcam_motion on
webcam_localhost off
```

Now the start motion manually (`sudo motion`) to check if it all works. 
Good, but we still have work to do before it will run as a service.
First, we need to enable it to do so by changing `/etc/defaults/motion` to the following

```
start_motion_daemon=yes
```

Second, the service will try to run as user `motion` instead of root, but that is a problem if we want to use port 80.
So we need to edit the sysinit script at `/etc/init.d/motion` and look for the following line

```bash
if start-stop-daemon --start --oknode --exec $DAEMON -b --child motion ; then
```

and remove the `--child motion` part so the line looks like this:

```bash
if start-stop-daemon --start --oknode --exec $DAEMON -b ; then
```

Now you should be able to start motion as a service using 
```bash
sudo service motion start
```

Cleaning up files
-----------------

The final problem is that motion is going to start spitting out images, and will continue to do so until all the space on your machine has been used up.
The [recommended solution](http://www.lavrsen.dk/foswiki/bin/view/Motion/FrequentlyAskedQuestions#How_do_I_delete_mpeg_files_older_than_x_days_63) is to use a cron job.

Edit roots cron file using

```bash
sudo crontab -e
```

and add the following line to remove any files motion that are older then 3 days, everyday at 1am.

```
# m h dom mon dow command
0 1 * * * /usr/bin/find /media/VIDEO -mtime +3 -and -type -f -and -name "*jpg" | xargs /bin/rm -f
```

----------------------------------------

To use this template:
=====================

 - Make a copy
 - Change the file name
 - Update the header info
  * change published to `true'
 - Delete these quick notes!

Add a tag!
----------

Its fast and easy!

Just go to `~/Source/notes/tags/` and add a file.md with the following content

    ---
    layout: blog_by_tag
    title: <tagnamegoeshere> posts
    tag: <tagnamegoeshere>
    permalink: <tagnamegoeshere>/
    ---

Don't forget to add the tag file when you commit!

Formatting
----------

_Italic_

**bold**

`FixedSpace`

Links
-----

Make [External Links](www.google.com) like this.

Make [Post Links]({% post_url 2014-09-04-udev-usb-mounting %}) like this.

Make [Static internal Links](/about/) would go to weaselpipe.com/about/.

Making [Reference Style Links][google] can be done [like][yahoo] so. Later on there should be a line like this

[google]: http://www.google.com/ "This is google"
[yahoo]: http://www.yahoo.com/ "Yahoo"


Writing code
------------

Description of what you are looking at

``` 
Code Here
```

Quoting Text
------------

I like to quote other peoples websites

-----------------------------
> Line one
> line two
> line three
> > Indented quote
> > line two of indented quote
> Line four
> line five
> line six
-----------------------------


Markdown lets you be lazy

-----------------------------
> Line one
line two
line three
> > Indented quote
> > line two of indented quote
Line four
line five
> line six
-----------------------------


Lists
-----

 * Red
 * Green
 * Blue

 - The number one
 - second thing
 - three


Images
------

![Alt Text](/path/to/image.jpg "optional title")

Alternatively, you can just use html syntax.
